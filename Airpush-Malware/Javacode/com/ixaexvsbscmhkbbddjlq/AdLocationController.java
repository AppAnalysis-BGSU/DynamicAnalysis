package com.ixaexvsbscmhkbbddjlq;

import android.content.Context;
import android.location.Location;
import android.location.LocationManager;
import android.util.Log;

public class AdLocationController extends AdController {
    private LocationManager f290c;
    private boolean f291d = false;
    private C0096M f292e;
    private C0096M f293f;
    private int f294g;
    private boolean f295h = false;

    public AdLocationController(AdView adView, Context context) {
        super(adView, context);
        try {
            this.f290c = (LocationManager) context.getSystemService("location");
            if (this.f290c.getProvider("gps") != null) {
                this.f292e = new C0096M(this, context, this, "gps");
            }
            if (this.f290c.getProvider("network") != null) {
                this.f293f = new C0096M(this, context, this, "network");
            }
            this.f291d = true;
        } catch (SecurityException e) {
        }
    }

    private static String m189a(Location location) {
        return "{ lat: " + location.getLatitude() + ", lon: " + location.getLongitude() + ", acc: " + location.getAccuracy() + "}";
    }

    public void allowLocationServices(boolean z) {
        this.f295h = z;
    }

    public boolean allowLocationServices() {
        return this.f295h;
    }

    public void fail() {
        Log.e("AdLocationController", "Location can't be determined");
        this.b.injectJavaScript("window.ormmaview.fireErrorEvent(\"Location cannot be identified\", \"AdOrmmaLocationController\")");
    }

    public String getLocation() {
        Log.d("AdLocationController", "getLocation: hasPermission: " + this.f291d);
        if (!this.f291d) {
            return null;
        }
        Location location = null;
        for (String lastKnownLocation : this.f290c.getProviders(true)) {
            location = this.f290c.getLastKnownLocation(lastKnownLocation);
            if (location != null) {
                break;
            }
        }
        Log.d("AdLocationController", "getLocation: " + location);
        return location != null ? m189a(location) : null;
    }

    public void startLocationListener() {
        if (this.f294g == 0) {
            if (this.f293f != null) {
                this.f293f.m176a();
            }
            if (this.f292e != null) {
                this.f292e.m176a();
            }
        }
        this.f294g++;
    }

    public void stopAllListeners() {
        this.f294g = 0;
        try {
            this.f292e.m177b();
        } catch (Exception e) {
        }
        try {
            this.f293f.m177b();
        } catch (Exception e2) {
        }
    }

    public void stopLocationListener() {
        this.f294g--;
        if (this.f294g == 0) {
            if (this.f293f != null) {
                this.f293f.m177b();
            }
            if (this.f292e != null) {
                this.f292e.m177b();
            }
        }
    }

    public void success(Location location) {
        String str = "window.ormmaview.fireChangeEvent({ location: " + m189a(location) + "})";
        Log.d("AdLocationController", str);
        this.b.injectJavaScript(str);
    }
}
