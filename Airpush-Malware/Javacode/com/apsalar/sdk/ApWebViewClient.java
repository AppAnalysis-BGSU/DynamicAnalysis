package com.apsalar.sdk;

import android.app.Activity;
import android.util.Log;
import android.webkit.WebView;
import android.webkit.WebViewClient;
import java.util.ArrayList;

public class ApWebViewClient extends WebViewClient {
    private ApsalarSessionInfo info = null;

    private void doCallback(String str) {
        int i = 0;
        if (Apsalar.registered_callbacks != null) {
            CallbackURL callbackURL = new CallbackURL(str);
            ApsalarItem apsalarItem = (ApsalarItem) Apsalar.registered_callbacks.get(callbackURL.signature);
            if (apsalarItem != null && apsalarItem.registered.booleanValue()) {
                Apsalar.eventJSON("__click__", callbackURL.clickParams);
                if (apsalarItem.val == null) {
                    Log.d("Apsalar SDK/ApWebView", "WebView is null ");
                } else if (apsalarItem.val instanceof WebView) {
                    String str2;
                    StringBuffer stringBuffer = new StringBuffer();
                    stringBuffer.append("javascript:");
                    WebView webView = (WebView) apsalarItem.val;
                    if (callbackURL.signature.contains("()")) {
                        str2 = callbackURL.signature;
                    } else {
                        StringBuffer stringBuffer2 = new StringBuffer();
                        String str3 = callbackURL.signature;
                        stringBuffer2.append(str3.substring(0, str3.indexOf("(") + 1));
                        ArrayList arrayList = callbackURL.argVals;
                        while (i < arrayList.size() - 1) {
                            stringBuffer2.append("'" + arrayList.get(i) + "'" + ",");
                            i++;
                        }
                        stringBuffer2.append("'" + arrayList.get(arrayList.size() - 1) + "'");
                        stringBuffer2.append(")");
                        str2 = stringBuffer2.toString();
                    }
                    stringBuffer.append(str2);
                    stringBuffer.append(";");
                    webView.loadUrl(stringBuffer.toString());
                    Log.d("Apsalar SDK/ApWebView", "JS Signature: " + stringBuffer.toString());
                } else {
                    ApCallback apCallback = (ApCallback) apsalarItem.val;
                    if (apCallback != null) {
                        apCallback.executeCallback(callbackURL.argValsJSON);
                    }
                }
            }
        }
    }

    public boolean shouldOverrideUrlLoading(WebView webView, String str) {
        if (str.equals("about:close") || str.equals("fbconnect:cancel")) {
            ((Activity) webView.getContext()).finish();
            Apsalar.triggerActive = Boolean.valueOf(false);
            return true;
        } else if (str.startsWith("callback:")) {
            doCallback(str);
            ((Activity) webView.getContext()).finish();
            Apsalar.triggerActive = Boolean.valueOf(false);
            return true;
        } else {
            Apsalar.triggerActive = Boolean.valueOf(false);
            return false;
        }
    }
}
